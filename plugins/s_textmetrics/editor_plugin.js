(function(){tinymce.create("scriptito.plugins.TextMetrics",{block:0,tid:null,ccid:null,wcid:null,scid:null,pcid:null,lcid:null,init:function(a,b){var c=this;c.editor=a;c.tid=a.id+"-metrics";c.ccid=a.id+"-character-count";c.wcid=a.id+"-word-count";c.scid=a.id+"-sentence-count";c.pcid=a.id+"-paragraph-count";c.lcid=a.id+"-line-count";c.state=a.getParam("s_textmetrics_on");a.addCommand("s_toggleMetrics",c._toggleMetrics,c);a.addButton("toggle_metrics",{title:"s_textmetrics.button_title",cmd:"s_toggleMetrics"});
a.onPostRender.add(function(e,d){var f,g;g=e.getParam("textmetrics_target_id");if(!g){f=tinymce.DOM.get(e.id+"_path_row");if(f){tinymce.DOM.add(f.parentNode,"div",{id:c.tid,"class":"metrics",style:"display:"+(c.state?"block;":"none;")},e.getParam("s_textmetrics_template",function(h,i){return"<span>"+h.getLang("s_textmetrics.characters","Characters: ")+'<span id="'+i.ccid+'">0</span></span><span>'+h.getLang("s_textmetrics.words","Words: ")+'<span id="'+i.wcid+'">0</span></span><span>'+h.getLang("s_textmetrics.sentences","Sentences: ")+'<span id="'+i.scid+'">0</span></span><span>'+h.getLang("s_textmetrics.paragraphs","Paragraphs: ")+'<span id="'+i.pcid+'">0</span></span><span>'+h.getLang("s_textmetrics.lines","Lines: ")+'<span id="'+i.lcid+'">0</span></span>'
})(e,c))}e.controlManager.setActive("toggle_metrics",c.state)}else{tinymce.DOM.add(g,"span",{},'<span id="'+c.wcid+'">0</span>')}});a.onSetContent.add(function(d){c._count(d)});a.onLoadContent.add(function(d){c._count(d)});a.onUndo.add(function(d){c._count(d)});a.onPaste.add(function(d){c._count(d)});a.onKeyUp.add(function(d,f){if(sTextUtils.isWhitespaceKeyCode(f.keyCode)||sTextUtils.isPunctuationKeyCode(f.keyCode)||8==f.keyCode||46==f.keyCode){c._count(d)}})},_count:function(b){var c=this,a=0;if(!c.state||c.block){return
}c.block=1;setTimeout(function(){var g=null;try{g=b.getContent({format:"raw"})}catch(h){}if(g){var j=tinymce.DOM;var f=sTextUtils.getMetricsForHtml(g,b.getParam("s_textmetrics_charsperline",80));var i=b.getParam("s_textmetrics_updater",function(k,l,e){l.setHTML(k.ccid,e.characterCount);l.setHTML(k.wcid,e.wordCount);l.setHTML(k.scid,e.sentenceCount);l.setHTML(k.pcid,e.paragraphCount);l.setHTML(k.lcid,e.lineCount)});i(c,j,f)}c.block=0},1)},_toggleMetrics:function(){var b=this,a=b.editor;b.state=!b.state;
a.controlManager.setActive("toggle_metrics",b.state);tinymce.DOM.setStyle(b.tid,"display",b.state?"block":"none");if(b.state){b._count(a)}},getInfo:function(){return{longname:"Text Metrics Plugin",author:"Scriptito, LLC",authorurl:"http://www.scriptito.com",infourl:"http://www.scriptito.com",version:"1.2.2"}}});tinymce.PluginManager.add("s_textmetrics",scriptito.plugins.TextMetrics)})();